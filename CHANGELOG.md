# 变更日志 (CHANGELOG)

本文档记录了串口文件传输工具的所有重要变更。

格式基于 [Keep a Changelog](https://keepachangelog.com/en/1.0.0/)，版本号遵循 [语义版本](https://semver.org/spec/v2.0.0.html)。

## [v1.5.0] - 2025-01-XX

### 新增功能 (Added)

- **P1-A 块大小一致性机制**: 支持发送端和接收端的块大小自动协商和一致性保证
- **NACK 回退优化**: 当请求长度超过协商块大小时，发送端自动发送 NACK 帧并提供建议长度
- **高波特率稳定性**: 增强对 1728000 波特率的支持，提升大文件传输稳定性
- **智能块大小调整**: 接收端收到 NACK 后自动调整 `max_data_length` 并重试
- **集成测试升级**: 支持多波特率 [115200, 1728000] 和多块大小 [1KB, 8KB] 的组合测试

### 改进 (Changed)

- **TransferConfig 增强**: 新增 `get_effective_chunk_size()` 方法，优先返回协商的块大小
- **FileSender 优化**: 在 `_wait_for_data_request()` 中增加超长请求的 NACK 处理
- **FileReceiver 增强**: 在 `receive_data_package()` 中增加 NACK 帧处理和块大小自适应
- **协议文档完善**: 新增"块大小一致性机制 (P1-A)"章节，详细描述 NACK 回退机制

### 修复 (Fixed)

- **测试环境兼容**: 修复 CLI 方法中 `input()` 调用导致的测试阻塞问题
- **Linter 错误处理**: 优化代码类型检查和错误处理逻辑
- **单元测试补充**: 新增 `test_receiver.py` 和相关测试用例

### 技术债务 (Technical)

- **测试覆盖率提升**: 新增 NACK 帧处理的单元测试用例
- **代码重构**: 优化串口管理和文件传输的错误处理机制
- **文档更新**: 完善协议规范文档和测试指南

---

## [v1.4.0] - 2025-01-XX

### 新增功能 (Added)

- **智能探测协商协议**: 7步自动协商流程，支持一键传输
- **多波特率支持**: 支持 115200, 460800, 921600, 1728000 波特率自动切换
- **能力协商机制**: 自动协商传输参数和文件信息
- **冲突检测处理**: 随机退避算法处理多设备同时探测
- **批量文件传输**: 支持文件夹的批量发送和接收

### 改进 (Changed)

- **用户界面优化**: 智能模式下的用户体验大幅提升
- **错误处理增强**: 探测失败时优雅降级到手动模式
- **进度显示改进**: 实时传输进度和速率显示

### 修复 (Fixed)

- **波特率切换稳定性**: 优化同步切换机制
- **大文件传输**: 修复大文件传输时的内存管理问题

---

## [v1.3.0] - 2024-12-XX

### 新增功能 (Added)

- **基础文件传输协议**: 单文件的可靠传输
- **串口自动检测**: 自动扫描可用串口
- **校验和验证**: 数据完整性保证
- **重试机制**: 网络异常时的自动重试

### 改进 (Changed)

- **协议框架**: 建立标准化的帧格式
- **错误处理**: 完善的异常处理机制

---

## [v1.2.0] - 2024-11-XX

### 新增功能 (Added)

- **命令行界面**: 基础的 CLI 操作接口
- **配置管理**: 串口和传输参数配置
- **日志系统**: 完整的日志记录和调试信息

### 改进 (Changed)

- **代码结构**: 模块化设计和职责分离
- **文档完善**: 用户指南和开发文档

---

## [v1.1.0] - 2024-10-XX

### 新增功能 (Added)

- **核心传输功能**: 基础的串口文件传输能力
- **数据帧处理**: 帧打包和解包功能
- **串口管理**: 串口连接和通信管理

### 修复 (Fixed)

- **传输稳定性**: 修复数据传输中的同步问题

---

## [v1.0.0] - 2024-09-XX

### 新增功能 (Added)

- **项目初始化**: 建立项目基础架构
- **基础工具类**: 核心工具和实用函数
- **测试框架**: 单元测试和集成测试框架

---

## 版本说明

### 版本号格式

- **主版本号 (MAJOR)**: 不兼容的 API 修改
- **次版本号 (MINOR)**: 向下兼容的功能性新增
- **修订号 (PATCH)**: 向下兼容的问题修正

### 变更类型

- **Added**: 新增功能
- **Changed**: 对现有功能的变更
- **Deprecated**: 不推荐使用的功能
- **Removed**: 移除的功能
- **Fixed**: 问题修复
- **Security**: 安全相关的修复

### 发布周期

- **稳定版**: 每月发布一次稳定版本
- **修复版**: 重要修复随时发布
- **预览版**: 新功能的预览版本

---

## 贡献指南

### 提交变更记录

1. 每个 Pull Request 都应该更新 CHANGELOG.md
2. 变更记录应该描述**对用户的影响**，而不是技术实现细节
3. 按照时间顺序组织变更，最新的在顶部
4. 使用清晰、简洁的语言描述变更

### 版本发布流程

1. 更新 CHANGELOG.md 中的版本号和发布日期
2. 确保所有测试通过
3. 创建版本标签 `git tag v1.x.x`
4. 发布到仓库 `git push origin v1.x.x`
